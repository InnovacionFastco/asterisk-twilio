[globals]
; Update these to match your deployment if required
OUTBOUND_TRUNK=twilio-trunk
TWILIO_DID=__TWILIO_DID__
TWILIO_SIP_DOMAIN=__TWILIO_SIP_DOMAIN__

[from-internal]
; Dial +E.164 numbers via Twilio
exten => _+X.,1,NoOp(Placing outbound call to ${EXTEN} through Twilio)
 same => n,Set(PJSIP_MEDIA_OFFER(audio)=ulaw,alaw,telephone-event)
 same => n,Dial(PJSIP/${OUTBOUND_TRUNK}/sip:${EXTEN}@${TWILIO_SIP_DOMAIN},45,r)
 same => n,Hangup()

; Quick loopback test to hear Twilio's demo prompt
exten => 1000,1,NoOp(Dialing Twilio demo number)
 same => n,Set(PJSIP_MEDIA_OFFER(audio)=ulaw,alaw,telephone-event)
 same => n,Dial(PJSIP/${OUTBOUND_TRUNK}/sip:+14155238886@${TWILIO_SIP_DOMAIN},45,r)
 same => n,Hangup()

[twilio-test]
exten => s,1,Answer()
 same => n,Playback(tt-weasels)
 same => n,Hangup()

[from-twilio]
; Route calls based on the DID you declared in .env (falls back to demo message)
exten => __TWILIO_DID__,1,NoOp(Inbound call for ${EXTEN} from Twilio)
 same => n,Answer()
 same => n,Dial(PJSIP/microsip,30,tT)
 same => n,Playback(demo-congrats)
 same => n,Hangup()

; Default catch-all for any other dialed number
exten => _X.,1,NoOp(Inbound call (catch-all) for ${EXTEN} from Twilio)
 same => n,Answer()
 same => n,Playback(demo-congrats)
 same => n,Hangup()
